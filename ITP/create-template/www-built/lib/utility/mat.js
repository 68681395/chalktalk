function cross(e,t,n){return n===undefined&&(n=[0,0,0]),n[0]=e[1]*t[2]-e[2]*t[1],n[1]=e[2]*t[0]-e[0]*t[2],n[2]=e[0]*t[1]-e[1]*t[0],n}function dot(e,t){return e.length<3||t.length<3?e[0]*t[0]+e[1]*t[1]:e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function lerp(e,t,n){return t+e*(n-t)}function norm(e){return sqrt(normSqr(e))}function normSqr(e){return dot(e,e)}function vecDiff(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}function vecLerp(e,t,n){return[lerp(e,t[0],n[0]),lerp(e,t[1],n[1]),lerp(e,t[2],n[2])]}function vecScale(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function vecSum(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function drawUnitDisk(e){renderUnitDisk(mDrawFace,e)}function fillUnitDisk(e){renderUnitDisk(mFillFace,e)}function renderUnitDisk(e,t){var n=[];for(var r=0;r<20;r++){var i=r*TAU/20+PI;n.push([cos(i),sin(i),0])}e(n)}function drawUnitTube(e){renderUnitTube(mDrawFace,e)}function fillUnitTube(e){renderUnitTube(mFillFace,e)}function renderUnitTube(e,t){for(var n=0;n<20;n++){var r=n*TAU/20+PI,i=(n+1)*TAU/20+PI,s=sin(r),o=cos(r),u=sin(i),a=cos(i);e([[o,s,1],[o,s,-1],[a,u,-1],[a,u,1]])}}function unitCubeCorners(){for(var e=0;e<pCube.length;e++)mPoint(pCube[e])}function drawUnitCube(e){renderUnitCube(mDrawFace,e)}function fillUnitCube(e){renderUnitCube(mFillFace,e)}function renderUnitCube(e,t){var n=pCube,r=[[0,1,5,4],[0,2,3,1],[0,4,6,2],[1,3,7,5],[2,6,7,3],[6,4,5,7]];for(var i=0;i<r.length;i++)e([n[r[i][0]],n[r[i][1]],n[r[i][2]],n[r[i][3]]],t)}function drawUnitSquare(){mCurve([[-1,-1],[1,-1],[1,1],[-1,1],[-1,-1]])}function fillUnitSquare(){mFillFace([[-1,-1],[1,-1],[1,1],[-1,1]]),mDrawFace([[-1,-1],[1,-1],[1,1],[-1,1]])}function standardView(e,t,n,r,i,s,o){o===undefined&&(o=m),o.identity(),o.translate(width()*e,height()*(1-t),0),o.perspective(0,0,-width()*2),o.rotateX(n),o.rotateY(r),o.rotateZ(i),s*=width(),o.scale(s,-s,s)}function standardViewInverse(e,t,n,r,i,s,o){o===undefined&&(o=m),o.identity(),s*=width(),o.scale(1/s,-1/s,1/s),o.rotateZ(-i),o.rotateY(-r),o.rotateX(-n),o.perspective(0,0,width()*2),o.translate(-width()*e,-height()*(1-t),0)}function mLine(e,t){var n=m.transform(e),r=m.transform(t);line(n[0],n[1],r[0],r[1])}function mPoint(e){var t=m.transform(e);_g_moveTo(t[0],t[1])}function mDrawFace(e,t){t===undefined&&(t="black");var n=[];for(var r=0;r<e.length;r++)n.push(m.transform(e[r]));polygonArea(n)>0&&drawPolygon(n)}function mFillFace(e,t){t===undefined&&(t="white");var n=[];for(var r=0;r<e.length;r++)n.push(m.transform(e[r]));if(polygonArea(n)>0){var i=color();color("white"),fillPolygon(n),color(i)}}function mCurve(e){var t=[];for(var n=0;n<e.length;n++)t.push(m.transform(e[n]));drawCurve(t)}function mClosedCurve(e){var t=[];for(var n=0;n<e.length;n++)t.push(m.transform(e[n]));drawClosedCurve(t)}function mFillCurve(e){var t=[];for(var n=0;n<e.length;n++)t.push(m.transform(e[n]));fillCurve(t)}function mArrow(e,t){var n=m.transform(e),r=m.transform(t);arrow(n[0],n[1],r[0],r[1],len(n[0]-r[0],n[1]-r[1])/10)}function mText(e,t,n,r){var i=m.transform(t);text(e,i[0],i[1],n,r)}var M4=function(){this._mS=[],this._to=0,this._mS[0]=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._m=function(e){return e!==undefined&&(this._mS[this._to]=e),this._mS[this._to]},this.aimX=function(e){var t=this._m(),n=e._m(),r=[n[12]-t[12],n[13]-t[13],n[14]-t[14]],i=[t[8],t[9],t[10]],s=cross(i,r);return cross(r,s,i),this.setOrientation(r,s,i)},this.aimY=function(e){var t=this._m(),n=e._m(),r=[n[12]-t[12],n[13]-t[13],n[14]-t[14]],i=[t[0],t[1],t[2]],s=cross(i,r);return cross(r,s,i),this.setOrientation(i,r,s)},this.aimZ=function(e){var t=this._m(),n=e._m(),r=[n[12]-t[12],n[13]-t[13],n[14]-t[14]],i=[t[4],t[5],t[6]],s=cross(i,r);return cross(r,s,i),this.setOrientation(s,i,r)},this.copy=function(e){for(var t=0;t<16;t++)this._m()[t]=e._m()[t];return this},this.identity=function(){return this._m(this._id()),this},this.normalMatrix=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return[e[0]/t,e[1]/t,e[2]/t,0,e[4]/n,e[5]/n,e[6]/n,0,e[8]/r,e[9]/r,e[10]/r,0,0,0,0,1]},this.normalize=function(e){var t=e[0],n=e[1],r=e[2],i=Math.sqrt(t*t+n*n+r*r);e[0]/=i,e[1]/=i,e[2]/=i},this.perspective=function(e,t,n){return this._xf(this._pe(e,t,n)),this},this.restore=function(){--this._to},this.rotateX=function(e){return this._xf(this._rX(e)),this},this.rotateY=function(e){return this._xf(this._rY(e)),this},this.rotateZ=function(e){return this._xf(this._rZ(e)),this},this.save=function(){this._mS[this._to+1]=this._mS[this._to++]},this.scale=function(e,t,n){return t===undefined&&(n=t=e),this._xf(this._sc(e,t,n)),this},this.setOrientation=function(e,t,n){this.normalize(e),this.normalize(t),this.normalize(n);var r=this._m();return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[4]=t[0],r[5]=t[1],r[6]=t[2],r[8]=n[0],r[9]=n[1],r[10]=n[2],this},this.toString=function(){var e="";for(var t=0;t<16;t++)e+=(t==0?"[":",")+roundedString(this._m()[t]);return e+"]"},this.translate=function(e,t,n){return this._xf(this._tr(e,t,n)),this},this.transpose=function(e){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]},this._xf=function(e){return this._m(this._mm(e,this._m()))},this._id=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},this._tr=function(e,t,n){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1]},this._rX=function(e){var t=Math.cos(e),n=Math.sin(e);return[1,0,0,0,0,t,n,0,0,-n,t,0,0,0,0,1]},this._rY=function(e){var t=Math.cos(e),n=Math.sin(e);return[t,0,-n,0,0,1,0,0,n,0,t,0,0,0,0,1]},this._rZ=function(e){var t=Math.cos(e),n=Math.sin(e);return[t,n,0,0,-n,t,0,0,0,0,1,0,0,0,0,1]},this._sc=function(e,t,n){return[e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1]},this._pe=function(e,t,n){var r=e*e+t*t+n*n;return[1,0,0,e/r,0,1,0,t/r,0,0,1,n/r,0,0,0,1]},this._d=function(e,t){return e[0]*t[0]+e[1]*t[1]+(t.length<3?0:e[2]*t[2])+(t.length<4?e[3]:e[3]*t[3])},this._x=function(e){return[e[0],e[1],e[2],e[3]]},this._y=function(e){return[e[4],e[5],e[6],e[7]]},this._z=function(e){return[e[8],e[9],e[10],e[11]]},this._w=function(e){return[e[12],e[13],e[14],e[15]]},this._mm=function(e,t){var n=this.transpose(t),r=this._x(e),i=this._y(e),s=this._z(e),o=this._w(e),u=this._x(n),a=this._y(n),f=this._z(n),l=this._w(n);return[this._d(r,u),this._d(r,a),this._d(r,f),this._d(r,l),this._d(i,u),this._d(i,a),this._d(i,f),this._d(i,l),this._d(s,u),this._d(s,a),this._d(s,f),this._d(s,l),this._d(o,u),this._d(o,a),this._d(o,f),this._d(o,l)]},this._mv=function(e,t){var n=this._m(),r=this._d([n[0],n[4],n[8],n[12]],t),i=this._d([n[1],n[5],n[9],n[13]],t),s=this._d([n[2],n[6],n[10],n[14]],t),o=this._d([n[3],n[7],n[11],n[15]],t);return t.length==4?[r,i,s,o]:[r/o,i/o,s/o]},this.transform=function(e){if(e[0]instanceof Array){var t=[];for(var n=0;n<e.length;n++)t.push(this.transform(e[n]));return t}return this._mv(this._m(),e)}},pCube=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],m=new M4;